import{r as g,n as Z,s as L,b as J,c as U,h as A,_ as Y,i as O,g as ee,m as ne,u as b,y as te,A as ae,am as ie,C as le,an as re,G as ce,ao as se,ah as W,a4 as o,a3 as R,a7 as d,a2 as oe,ab as de,ac as k,aa as P,a6 as ue}from"./index-2Og1nv0n.js";import{g as D,b as z,I as X}from"./index-BDRk5EhP.js";import{TAGS_CATEGORY as he}from"./Home-5ZKr9buw.js";import{F as _,M as ge,u as pe,P as me,a as Se}from"./index-BqZjKmYw.js";import{S as H,u as ye,P as $e}from"./index-BQXgRjwF.js";import{u as Ce}from"./useTime-BW_M2mMm.js";import{u as q}from"./index-CYqDg7_g.js";import"./MySkeleton-BIgMNdIE.js";import"./TemplateCard-BE_FMq4j.js";import"./index-BH574STE.js";var Ie=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],B=g.forwardRef(function(e,n){var a,i=e.prefixCls,s=i===void 0?"rc-switch":i,u=e.className,h=e.checked,t=e.defaultChecked,l=e.disabled,r=e.loadingIcon,p=e.checkedChildren,y=e.unCheckedChildren,w=e.onClick,C=e.onChange,m=e.onKeyDown,j=Z(e,Ie),I=L(!1,{value:h,defaultValue:t}),v=J(I,2),x=v[0],c=v[1];function S($,E){var M=x;return l||(M=$,c(M),C==null||C(M,E)),M}function T($){$.which===O.LEFT?S(!1,$):$.which===O.RIGHT&&S(!0,$),m==null||m($)}function f($){var E=S(!x,$);w==null||w(E,$)}var N=U(s,u,(a={},A(a,"".concat(s,"-checked"),x),A(a,"".concat(s,"-disabled"),l),a));return g.createElement("button",Y({},j,{type:"button",role:"switch","aria-checked":x,disabled:l,className:N,ref:n,onKeyDown:T,onClick:f}),r,g.createElement("span",{className:"".concat(s,"-inner")},g.createElement("span",{className:"".concat(s,"-inner-checked")},p),g.createElement("span",{className:"".concat(s,"-inner-unchecked")},y)))});B.displayName="Switch";const fe=e=>{const{componentCls:n,trackHeightSM:a,trackPadding:i,trackMinWidthSM:s,innerMinMarginSM:u,innerMaxMarginSM:h,handleSizeSM:t,calc:l}=e,r=`${n}-inner`,p=b(l(t).add(l(i).mul(2)).equal()),y=b(l(h).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:s,height:a,lineHeight:b(a),[`${n}-inner`]:{paddingInlineStart:h,paddingInlineEnd:u,[`${r}-checked, ${r}-unchecked`]:{minHeight:a},[`${r}-checked`]:{marginInlineStart:`calc(-100% + ${p} - ${y})`,marginInlineEnd:`calc(100% - ${p} + ${y})`},[`${r}-unchecked`]:{marginTop:l(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:t,height:t},[`${n}-loading-icon`]:{top:l(l(t).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:u,paddingInlineEnd:h,[`${r}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${r}-unchecked`]:{marginInlineStart:`calc(100% - ${p} + ${y})`,marginInlineEnd:`calc(-100% + ${p} - ${y})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${b(l(t).add(i).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${r}`]:{[`${r}-unchecked`]:{marginInlineStart:l(e.marginXXS).div(2).equal(),marginInlineEnd:l(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${r}`]:{[`${r}-checked`]:{marginInlineStart:l(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:l(e.marginXXS).div(2).equal()}}}}}}},we=e=>{const{componentCls:n,handleSize:a,calc:i}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:i(i(a).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},xe=e=>{const{componentCls:n,trackPadding:a,handleBg:i,handleShadow:s,handleSize:u,calc:h}=e,t=`${n}-handle`;return{[n]:{[t]:{position:"absolute",top:a,insetInlineStart:a,width:u,height:u,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:h(u).div(2).equal(),boxShadow:s,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${t}`]:{insetInlineStart:`calc(100% - ${b(h(u).add(a).equal())})`},[`&:not(${n}-disabled):active`]:{[`${t}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${t}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},be=e=>{const{componentCls:n,trackHeight:a,trackPadding:i,innerMinMargin:s,innerMaxMargin:u,handleSize:h,calc:t}=e,l=`${n}-inner`,r=b(t(h).add(t(i).mul(2)).equal()),p=b(t(u).mul(2).equal());return{[n]:{[l]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:u,paddingInlineEnd:s,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${l}-checked, ${l}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:a},[`${l}-checked`]:{marginInlineStart:`calc(-100% + ${r} - ${p})`,marginInlineEnd:`calc(100% - ${r} + ${p})`},[`${l}-unchecked`]:{marginTop:t(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${l}`]:{paddingInlineStart:s,paddingInlineEnd:u,[`${l}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${l}-unchecked`]:{marginInlineStart:`calc(100% - ${r} + ${p})`,marginInlineEnd:`calc(-100% + ${r} - ${p})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${l}`]:{[`${l}-unchecked`]:{marginInlineStart:t(i).mul(2).equal(),marginInlineEnd:t(i).mul(-1).mul(2).equal()}},[`&${n}-checked ${l}`]:{[`${l}-checked`]:{marginInlineStart:t(i).mul(-1).mul(2).equal(),marginInlineEnd:t(i).mul(2).equal()}}}}}},ve=e=>{const{componentCls:n,trackHeight:a,trackMinWidth:i}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},te(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:a,lineHeight:`${b(a)}`,verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),ae(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},ke=e=>{const{fontSize:n,lineHeight:a,controlHeight:i,colorWhite:s}=e,u=n*a,h=i/2,t=2,l=u-t*2,r=h-t*2;return{trackHeight:u,trackHeightSM:h,trackMinWidth:l*2+t*4,trackMinWidthSM:r*2+t*2,trackPadding:t,handleBg:s,handleSize:l,handleSizeSM:r,handleShadow:`0 2px 4px 0 ${new ie("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:l/2,innerMaxMargin:l+t+t*2,innerMinMarginSM:r/2,innerMaxMarginSM:r+t+t*2}},Te=ee("Switch",e=>{const n=ne(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[ve(n),be(n),xe(n),we(n),fe(n)]},ke);var Me=function(e,n){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(a[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]]);return a};const je=g.forwardRef((e,n)=>{const{prefixCls:a,size:i,disabled:s,loading:u,className:h,rootClassName:t,style:l,checked:r,value:p,defaultChecked:y,defaultValue:w,onChange:C}=e,m=Me(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[j,I]=L(!1,{value:r??p,defaultValue:y??w}),{getPrefixCls:v,direction:x,switch:c}=g.useContext(le),S=g.useContext(re),T=(s??S)||u,f=v("switch",a),N=g.createElement("div",{className:`${f}-handle`},u&&g.createElement(W,{className:`${f}-loading-icon`})),[$,E,M]=Te(f),Q=ce(i),K=U(c==null?void 0:c.className,{[`${f}-small`]:Q==="small",[`${f}-loading`]:u,[`${f}-rtl`]:x==="rtl"},h,t,E,M),V=Object.assign(Object.assign({},c==null?void 0:c.style),l),G=function(){I(arguments.length<=0?void 0:arguments[0]),C==null||C.apply(void 0,arguments)};return $(g.createElement(se,{component:"Switch"},g.createElement(B,Object.assign({},m,{checked:j,onChange:G,prefixCls:f,className:K,style:V,disabled:T,ref:n,loadingIcon:N}))))}),F=je;F.__ANT_SWITCH=!0;const Ee=({value:e,onChange:n})=>{const[a,i]=g.useState(!1);return o.jsx(F,{size:"small",loading:a,value:e,onChange:async s=>{i(!0),await n(s),i(!1)}})},_e=D(`
  query GetTemplateInfo($id:Int!){
    templateWithUser(id: $id){
      categoryId
      sourceCodeUrl
      tags{
        id
      }
    }
  }
`),De=e=>{const{id:n,open:a,onClose:i,onOk:s}=e;if(!n)return null;const[u,h]=g.useState(!1);R();const{data:t,loading:l}=z(he),{data:r,loading:p}=z(_e,{variables:{id:n}}),[y]=_.useForm();g.useEffect(()=>{r&&y.setFieldsValue({categoryId:r.templateWithUser.categoryId,sourceCodeUrl:r.templateWithUser.sourceCodeUrl,tagIds:r.templateWithUser.tags.map(m=>m.id)})},[r]);const w=g.useMemo(()=>(t==null?void 0:t.categories.categories.map(m=>({value:m.id,label:m.name})))??[],[t]),C=g.useMemo(()=>(t==null?void 0:t.tags.tags.map(m=>({value:m.id,label:m.name})))??[],[t]);return o.jsx(ge,{open:a,centered:!0,title:d._({id:"D6YXEk"}),onCancel:()=>i(),onOk:async()=>{h(!0);const m=await y.validateFields();await(s==null?void 0:s(m)),h(!1)},okButtonProps:{loading:u},okText:d._({id:"+o7WDh"}),cancelText:d._({id:"jxD+iQ"}),children:o.jsxs(_,{layout:"vertical",form:y,children:[o.jsx(_.Item,{label:d._({id:"4c0lyF"}),name:"categoryId",rules:[{required:!0,message:d._({id:"EC03k5"})}],children:o.jsx(H,{options:w,loading:l||p,placeholder:d._({id:"EC03k5"})})}),o.jsx(_.Item,{label:d._({id:"9qqIHt"}),name:"tagIds",children:o.jsx(H,{options:C,placeholder:d._({id:"k1ZrdF"}),allowClear:!0,loading:l||p,mode:"multiple",maxCount:3})}),o.jsx(_.Item,{label:d._({id:"ApfW72"}),name:"sourceCodeUrl",children:o.jsx(X,{placeholder:d._({id:"iDskXR"})})})]})})},{Search:Ne}=X,Pe=D(`
  query MyTemplates($pagination:Pagination,$search:String){
    templatesByUser(pagination: $pagination,search: $search){
      total
      allCount
      templates{
        id
        isPublic
        name
        createAt
        updateAt
        sourceCodeUrl
      }
    }
  }
`),qe=D(`
  mutation DeleteTemplate($id:Int!){
    deleteTemplate(id:$id)
  }
`),ze=D(`
  mutation UpdateTemplate($id:Int!,$input:TemplateUpdateInput!){
    updateTemplate(id: $id,input: $input){
      id
    }
  }
`),Ae=D(`
  mutation UpdateTemplateTags($input:TemplateTagInput!){
    updateTags(input: $input)
  }
`),Ke=()=>{R();const e=oe(),{message:n}=de.useApp(),[a,i]=ye({page:1}),[s,u]=g.useState(),[h,t]=g.useState(!1),l=g.useRef(null),r=pe(l),p=10,{formatTime:y,calcRelativeTimeNow:w}=Ce(),[C]=q(qe,{refetchQueries:["MyTemplates"]}),[m]=q(ze,{refetchQueries:["MyTemplates"]}),[j]=q(Ae,{refetchQueries:["MyTemplates"]}),{data:I,loading:v}=z(Pe,{variables:{pagination:{page:(a==null?void 0:a.page)>1?a.page-1:0,pageSize:p},search:a.search}}),x=[{dataIndex:"name",title:d._({id:"NNjpON"}),width:100,render:(c,S)=>o.jsx(k.Link,{onClick:()=>e(`/template/${S.id}`),children:c})},{dataIndex:"createAt",title:d._({id:"i9SLU7"}),width:150,render:c=>o.jsx(k.Text,{ellipsis:{tooltip:c},children:y(c)}),sorter:(c,S)=>new Date(S.createAt).getTime()-new Date(c.createAt).getTime()},{dataIndex:"updateAt",title:d._({id:"6NpxEF"}),width:150,render:c=>o.jsx(k.Text,{ellipsis:{tooltip:c},children:w(c)}),sorter:(c,S)=>new Date(S.createAt).getTime()-new Date(c.createAt).getTime()},{dataIndex:"sourceCodeUrl",title:d._({id:"Xma9Tn"}),width:150,render:c=>c?o.jsx(k.Link,{href:c,ellipsis:!0,children:c}):o.jsx(k.Text,{type:"secondary",children:o.jsx(P,{id:"XvTqzn"})})},{dataIndex:"isPublic",title:d._({id:"QHCV6v"}),width:80,render:(c,S)=>o.jsx(Ee,{value:c,onChange:async T=>{try{n.open({key:"public",type:"loading",duration:0,content:d._({id:"lE9b32"})}),await m({variables:{id:S.id,input:{isPublic:T.valueOf()}}}),n.open({key:"public",type:"success",content:d._({id:"Cl0ZDA"})})}catch{n.open({key:"public",type:"error",content:d._({id:"jx5Bb/"})})}}})},{title:d._({id:"5oBbwZ"}),width:100,render:(c,S)=>o.jsxs(ue,{size:"large",children:[o.jsx(k.Link,{onClick:()=>{u(S.id),t(!0)},children:o.jsx(P,{id:"zil5pJ"})}),o.jsx(me,{title:d._({id:"9yTD3N"}),description:d._({id:"KJISXT"}),okText:d._({id:"6Ql6i3"}),cancelText:d._({id:"jxD+iQ"}),onConfirm:async()=>{try{n.open({key:"delete",type:"loading",duration:0,content:d._({id:"Bj6nL6"})}),await C({variables:{id:S.id}}),n.open({key:"delete",type:"success",content:d._({id:"B9we9a"})})}catch{n.open({key:"delete",type:"error",content:d._({id:"DX31Ex"})})}},children:o.jsx(k.Link,{className:"m-0 ",style:{color:"#ff2442"},children:o.jsx(P,{id:"tGxdbR"})})})]})}];return o.jsxs("div",{className:"w-full h-full p-4",children:[o.jsxs("div",{className:"bg-white w-full h-full flex flex-col rounded-lg p-4 gap-2",children:[o.jsx(Ne,{placeholder:d._({id:"hTxpDf"}),allowClear:!0,value:a.search,className:" max-w-[50%] mx-auto",onChange:c=>{i({search:c.target.value})},loading:v,enterButton:!0}),o.jsx("div",{className:"flex-1 overflow-hidden",ref:l,children:o.jsx(Se,{pagination:!1,scroll:{y:r==null?void 0:r.height,x:r==null?void 0:r.width},loading:{spinning:v,indicator:o.jsx(W,{style:{fontSize:24}})},rowKey:c=>c.id,columns:x,virtual:!0,dataSource:I==null?void 0:I.templatesByUser.templates})}),o.jsx("div",{className:"flex justify-end",children:o.jsx($e,{pageSize:p,total:I==null?void 0:I.templatesByUser.total,current:a.page,onChange:c=>{i({page:c})},showSizeChanger:!1})})]}),o.jsx(De,{id:s,open:h,onClose:()=>{t(!1),u(void 0)},onOk:async c=>{try{n.open({key:"update",type:"loading",duration:0,content:d._({id:"lE9b32"})}),await m({variables:{id:s,input:{sourceCodeUrl:c.sourceCodeUrl,categoryId:c.categoryId}}}),await j({variables:{input:{templateId:s,tagId:c.tagIds}}}),n.open({key:"update",type:"success",content:d._({id:"Cl0ZDA"})})}catch{n.open({key:"update",type:"error",content:d._({id:"jx5Bb/"})})}finally{u(void 0),t(!1)}}})]})};export{Ke as Component};
