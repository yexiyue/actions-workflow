import{r as m,n as G,s as U,b as Z,c as L,h as A,_ as J,i as O,g as Y,m as ee,u as b,y as ne,A as ae,am as te,C as ie,an as le,G as re,ao as ce,ah as se,a3 as W,a4 as d,a7 as u,a2 as oe,ab as de,ac as v,aa as P,a6 as ue}from"./index-CNm7ylrt.js";import{g as _,b as z,I as R}from"./index-Daa7Jgxx.js";import{TAGS_CATEGORY as he}from"./Home-CfTs4fzx.js";import{F as D,M as ge,u as me,P as pe,a as Se}from"./index-DByOtA6p.js";import{S as H,u as $e,P as Ce}from"./index-NDjTGhAF.js";import{u as Ie}from"./useTime-D7p7YOta.js";import{u as q}from"./index-CBuKcFEw.js";import"./tagMapColor-v6oxmCvI.js";import"./TemplateCard-CtQujdeu.js";import"./index-BYu9k_cg.js";var we=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],X=m.forwardRef(function(e,n){var i,l=e.prefixCls,s=l===void 0?"rc-switch":l,o=e.className,g=e.checked,a=e.defaultChecked,t=e.disabled,c=e.loadingIcon,h=e.checkedChildren,S=e.unCheckedChildren,y=e.onClick,w=e.onChange,x=e.onKeyDown,j=G(e,we),C=U(!1,{value:g,defaultValue:a}),T=Z(C,2),f=T[0],r=T[1];function p($,E){var M=f;return t||(M=$,r(M),w==null||w(M,E)),M}function k($){$.which===O.LEFT?p(!1,$):$.which===O.RIGHT&&p(!0,$),x==null||x($)}function I($){var E=p(!f,$);y==null||y(E,$)}var N=L(s,o,(i={},A(i,"".concat(s,"-checked"),f),A(i,"".concat(s,"-disabled"),t),i));return m.createElement("button",J({},j,{type:"button",role:"switch","aria-checked":f,disabled:t,className:N,ref:n,onKeyDown:k,onClick:I}),c,m.createElement("span",{className:"".concat(s,"-inner")},m.createElement("span",{className:"".concat(s,"-inner-checked")},h),m.createElement("span",{className:"".concat(s,"-inner-unchecked")},S)))});X.displayName="Switch";const xe=e=>{const{componentCls:n,trackHeightSM:i,trackPadding:l,trackMinWidthSM:s,innerMinMarginSM:o,innerMaxMarginSM:g,handleSizeSM:a,calc:t}=e,c=`${n}-inner`,h=b(t(a).add(t(l).mul(2)).equal()),S=b(t(g).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:s,height:i,lineHeight:b(i),[`${n}-inner`]:{paddingInlineStart:g,paddingInlineEnd:o,[`${c}-checked, ${c}-unchecked`]:{minHeight:i},[`${c}-checked`]:{marginInlineStart:`calc(-100% + ${h} - ${S})`,marginInlineEnd:`calc(100% - ${h} + ${S})`},[`${c}-unchecked`]:{marginTop:t(i).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:a,height:a},[`${n}-loading-icon`]:{top:t(t(a).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:o,paddingInlineEnd:g,[`${c}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${c}-unchecked`]:{marginInlineStart:`calc(100% - ${h} + ${S})`,marginInlineEnd:`calc(-100% + ${h} - ${S})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${b(t(a).add(l).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${c}`]:{[`${c}-unchecked`]:{marginInlineStart:t(e.marginXXS).div(2).equal(),marginInlineEnd:t(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${c}`]:{[`${c}-checked`]:{marginInlineStart:t(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:t(e.marginXXS).div(2).equal()}}}}}}},fe=e=>{const{componentCls:n,handleSize:i,calc:l}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:l(l(i).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},be=e=>{const{componentCls:n,trackPadding:i,handleBg:l,handleShadow:s,handleSize:o,calc:g}=e,a=`${n}-handle`;return{[n]:{[a]:{position:"absolute",top:i,insetInlineStart:i,width:o,height:o,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:l,borderRadius:g(o).div(2).equal(),boxShadow:s,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${a}`]:{insetInlineStart:`calc(100% - ${b(g(o).add(i).equal())})`},[`&:not(${n}-disabled):active`]:{[`${a}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${a}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},ye=e=>{const{componentCls:n,trackHeight:i,trackPadding:l,innerMinMargin:s,innerMaxMargin:o,handleSize:g,calc:a}=e,t=`${n}-inner`,c=b(a(g).add(a(l).mul(2)).equal()),h=b(a(o).mul(2).equal());return{[n]:{[t]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:o,paddingInlineEnd:s,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${t}-checked, ${t}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:i},[`${t}-checked`]:{marginInlineStart:`calc(-100% + ${c} - ${h})`,marginInlineEnd:`calc(100% - ${c} + ${h})`},[`${t}-unchecked`]:{marginTop:a(i).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${t}`]:{paddingInlineStart:s,paddingInlineEnd:o,[`${t}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${t}-unchecked`]:{marginInlineStart:`calc(100% - ${c} + ${h})`,marginInlineEnd:`calc(-100% + ${c} - ${h})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${t}`]:{[`${t}-unchecked`]:{marginInlineStart:a(l).mul(2).equal(),marginInlineEnd:a(l).mul(-1).mul(2).equal()}},[`&${n}-checked ${t}`]:{[`${t}-checked`]:{marginInlineStart:a(l).mul(-1).mul(2).equal(),marginInlineEnd:a(l).mul(2).equal()}}}}}},ve=e=>{const{componentCls:n,trackHeight:i,trackMinWidth:l}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},ne(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:l,height:i,lineHeight:`${b(i)}`,verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),ae(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},Te=e=>{const{fontSize:n,lineHeight:i,controlHeight:l,colorWhite:s}=e,o=n*i,g=l/2,a=2,t=o-a*2,c=g-a*2;return{trackHeight:o,trackHeightSM:g,trackMinWidth:t*2+a*4,trackMinWidthSM:c*2+a*2,trackPadding:a,handleBg:s,handleSize:t,handleSizeSM:c,handleShadow:`0 2px 4px 0 ${new te("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:t/2,innerMaxMargin:t+a+a*2,innerMinMarginSM:c/2,innerMaxMarginSM:c+a+a*2}},ke=Y("Switch",e=>{const n=ee(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[ve(n),ye(n),be(n),fe(n),xe(n)]},Te);var Me=function(e,n){var i={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&n.indexOf(l)<0&&(i[l]=e[l]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,l=Object.getOwnPropertySymbols(e);s<l.length;s++)n.indexOf(l[s])<0&&Object.prototype.propertyIsEnumerable.call(e,l[s])&&(i[l[s]]=e[l[s]]);return i};const je=m.forwardRef((e,n)=>{const{prefixCls:i,size:l,disabled:s,loading:o,className:g,rootClassName:a,style:t,checked:c,value:h,defaultChecked:S,defaultValue:y,onChange:w}=e,x=Me(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[j,C]=U(!1,{value:c??h,defaultValue:S??y}),{getPrefixCls:T,direction:f,switch:r}=m.useContext(ie),p=m.useContext(le),k=(s??p)||o,I=T("switch",i),N=m.createElement("div",{className:`${I}-handle`},o&&m.createElement(se,{className:`${I}-loading-icon`})),[$,E,M]=ke(I),B=re(l),Q=L(r==null?void 0:r.className,{[`${I}-small`]:B==="small",[`${I}-loading`]:o,[`${I}-rtl`]:f==="rtl"},g,a,E,M),K=Object.assign(Object.assign({},r==null?void 0:r.style),t),V=function(){C(arguments.length<=0?void 0:arguments[0]),w==null||w.apply(void 0,arguments)};return $(m.createElement(ce,{component:"Switch"},m.createElement(X,Object.assign({},x,{checked:j,onChange:V,prefixCls:I,className:Q,style:K,disabled:k,ref:n,loadingIcon:N}))))}),F=je;F.__ANT_SWITCH=!0;const Ee=_(`
  query GetTemplateInfo($id:Int!){
    templateWithUser(id: $id){
      categoryId
      sourceCodeUrl
      tags{
        id
      }
    }
  }
`),De=e=>{const{id:n,open:i,onClose:l,onOk:s}=e;if(!n)return null;W();const{data:o}=z(he),{data:g}=z(Ee,{variables:{id:n}}),[a]=D.useForm();m.useEffect(()=>{g&&a.setFieldsValue({categoryId:g.templateWithUser.categoryId,sourceCodeUrl:g.templateWithUser.sourceCodeUrl,tagIds:g.templateWithUser.tags.map(h=>h.id)})},[g]);const t=m.useMemo(()=>(o==null?void 0:o.categories.categories.map(h=>({value:h.id,label:h.name})))??[],[o]),c=m.useMemo(()=>(o==null?void 0:o.tags.tags.map(h=>({value:h.id,label:h.name})))??[],[o]);return d.jsx(ge,{open:i,centered:!0,title:u._({id:"D6YXEk"}),onCancel:()=>l(),onOk:async()=>{const h=await a.validateFields();await(s==null?void 0:s(h))},okText:u._({id:"+o7WDh"}),cancelText:u._({id:"jxD+iQ"}),children:d.jsxs(D,{layout:"vertical",form:a,children:[d.jsx(D.Item,{label:u._({id:"4c0lyF"}),name:"categoryId",rules:[{required:!0,message:u._({id:"EC03k5"})}],children:d.jsx(H,{options:t,placeholder:u._({id:"EC03k5"})})}),d.jsx(D.Item,{label:u._({id:"9qqIHt"}),name:"tagIds",children:d.jsx(H,{options:c,placeholder:u._({id:"k1ZrdF"}),allowClear:!0,mode:"multiple",maxCount:3})}),d.jsx(D.Item,{label:u._({id:"ApfW72"}),name:"sourceCodeUrl",children:d.jsx(R,{placeholder:u._({id:"iDskXR"})})})]})})},{Search:_e}=R,Ne=_(`
  query MyTemplates($pagination:Pagination,$search:String){
    templatesByUser(pagination: $pagination,search: $search){
      total
      allCount
      templates{
        id
        isPublic
        name
        createAt
        updateAt
        sourceCodeUrl
      }
    }
  }
`),Pe=_(`
  mutation DeleteTemplate($id:Int!){
    deleteTemplate(id:$id)
  }
`),qe=_(`
  mutation UpdateTemplate($id:Int!,$input:TemplateUpdateInput!){
    updateTemplate(id: $id,input: $input){
      id
    }
  }
`),ze=_(`
  mutation UpdateTemplateTags($input:TemplateTagInput!){
    updateTags(input: $input)
  }
`),Qe=()=>{W();const e=oe(),{message:n}=de.useApp(),[i,l]=$e({page:1}),[s,o]=m.useState(),[g,a]=m.useState(!1),t=m.useRef(null),c=me(t),h=10,{formatTime:S,calcRelativeTimeNow:y}=Ie(),[w]=q(Pe,{refetchQueries:["MyTemplates"]}),[x]=q(qe,{refetchQueries:["MyTemplates"]}),[j]=q(ze,{refetchQueries:["MyTemplates"]}),{data:C,loading:T}=z(Ne,{variables:{pagination:{page:(i==null?void 0:i.page)>1?i.page-1:0,pageSize:h},search:i.search}}),f=[{dataIndex:"name",title:u._({id:"NNjpON"}),width:100,render:(r,p)=>d.jsx(v.Link,{onClick:()=>e(`/template/${p.id}`),children:r})},{dataIndex:"createAt",title:u._({id:"i9SLU7"}),width:150,render:r=>d.jsx(v.Text,{ellipsis:{tooltip:r},children:S(r)}),sorter:(r,p)=>new Date(p.createAt).getTime()-new Date(r.createAt).getTime()},{dataIndex:"updateAt",title:u._({id:"6NpxEF"}),width:150,render:r=>d.jsx(v.Text,{ellipsis:{tooltip:r},children:y(r)}),sorter:(r,p)=>new Date(p.createAt).getTime()-new Date(r.createAt).getTime()},{dataIndex:"sourceCodeUrl",title:u._({id:"Xma9Tn"}),width:120,render:r=>r?d.jsx(v.Link,{href:r,children:r}):d.jsx(v.Text,{type:"secondary",children:d.jsx(P,{id:"XvTqzn"})})},{dataIndex:"isPublic",title:u._({id:"QHCV6v"}),width:80,render:(r,p)=>d.jsx(F,{size:"small",value:r,onChange:async k=>{try{await x({variables:{id:p.id,input:{isPublic:k.valueOf()}}}),n.success(u._({id:"Cl0ZDA"}))}catch{n.error(u._({id:"jx5Bb/"}))}}})},{title:u._({id:"5oBbwZ"}),width:100,render:(r,p)=>d.jsxs(ue,{size:"large",children:[d.jsx(v.Link,{onClick:()=>{o(p.id),a(!0)},children:d.jsx(P,{id:"zil5pJ"})}),d.jsx(pe,{title:u._({id:"9yTD3N"}),description:u._({id:"KJISXT"}),okText:u._({id:"6Ql6i3"}),cancelText:u._({id:"jxD+iQ"}),onConfirm:async()=>{try{await w({variables:{id:p.id}}),n.success(u._({id:"B9we9a"}))}catch{n.error(u._({id:"DX31Ex"}))}},children:d.jsx(v.Link,{className:"m-0 ",style:{color:"#ff2442"},children:d.jsx(P,{id:"tGxdbR"})})})]})}];return d.jsxs("div",{className:"w-full h-full p-4",children:[d.jsxs("div",{className:"bg-white w-full h-full flex flex-col rounded-lg p-4 gap-2",children:[d.jsx(_e,{placeholder:u._({id:"hTxpDf"}),allowClear:!0,value:i.search,className:" max-w-[50%] mx-auto",onChange:r=>{l({search:r.target.value})},loading:T,enterButton:!0}),d.jsx("div",{className:"flex-1 overflow-hidden",ref:t,children:d.jsx(Se,{pagination:!1,scroll:{y:c==null?void 0:c.height,x:c==null?void 0:c.width},rowKey:r=>r.id,columns:f,virtual:!0,dataSource:C==null?void 0:C.templatesByUser.templates})}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Ce,{pageSize:h,total:C==null?void 0:C.templatesByUser.total,current:i.page,onChange:r=>{l({page:r})},showSizeChanger:!1})})]}),d.jsx(De,{id:s,open:g,onClose:()=>{a(!1),o(void 0)},onOk:async r=>{try{await x({variables:{id:s,input:{sourceCodeUrl:r.sourceCodeUrl,categoryId:r.categoryId}}}),await j({variables:{input:{templateId:s,tagId:r.tagIds}}}),n.success(u._({id:"Cl0ZDA"}))}catch{n.error(u._({id:"jx5Bb/"}))}finally{o(void 0),a(!1)}}})]})};export{Qe as Component};
